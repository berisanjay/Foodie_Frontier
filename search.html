<html>
    <head>
      <title>Search Restaurants</title>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
  
    </head>
    <style>
          body { 

box-sizing: border-box;
background-color: rgb(44, 133, 211);
background-image: url('./food.jpg');
background-repeat: no-repeat;
background-size: cover;       /* Changed from 'contain' to 'cover' */
background-position: center; 
background-attachment: fixed;
height: 100vh;
 /* Optional: centers the image */
}
  header{
    
    position:sticky;
      background-color:rgba(255, 255, 255, 0.384);
  }
  header>a{
      margin-left: 10%;
  }
  header>ul{
      margin-right: 10%;
  }
  .fs-4{
      color: rgb(255, 255, 255);
      font-family: cursive;

  }
  .nav-link{
      font-size: 1.5rem;
      color: aliceblue;
      font-family: cursive;
  }

  #text{
      color:aliceblue;
      margin: 0 10%;

  }
  h2{
      font-size: 2.5em;
      
      font-family:cursive
  }
  #text>p{
      font-size:2em;
      font-family:cursive
  }
  h6{
      font-style: italic;
      
      font-family:cursive;
      margin:0 25%;
  }

  h2::first-letter{
      font-size:4em;
      font-family: serif;
      padding: 0;
      margin: 0;

  }
  .button{
      margin: 100px 10%;
      display: flex;
      justify-content:center;
      align-items: center;
      flex-direction: row;
      gap: 50px;
  }
  .btn{
      width: 200px;
      color:blue;
      font-weight: 800;
      font-size:large;
       
      font-family:cursive;
      background-color: rgb(255, 255, 255);
      border-color: aliceblue;
      height: 60px;

  }

  .nav-link:hover{
      background-color: blue;
      color: aliceblue;
  }
  #scrollspyHeading2
  {
      margin: 0 10%;
  }
  .mb-3
  {
    margin: 0 10%;

  }
    details {
        margin-bottom: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 10px;
        
        font-family: cursive;
            background-color:#162d454b;
      }
       
      summary {
        font-size: 1.2em;
        cursor: pointer;
        padding: 5px;
        background-color: #007bff;
        color: white;
        border-radius: 5px;
        margin-bottom: 10px;
        width: 200px; 
        margin: 10px auto;
      }
      
      form {
        margin-top: 10px;
      }
      input{
        border: 1px solid;
        border-radius: 6px; 
      }
      
      label {
        display: block;
        margin-bottom: 5px;
        color:aliceblue;
      }
      
      input[type="text"], input[type="file"] {
        width: 56%;
        padding: 5px;
        margin-bottom: 10px;
      }
      input::placeholder{
        font-family: cursive;
      }
      .button{
        margin: 0;
      }
      button {
        padding: 5px 10px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      .button>button{
        font-family: cursive;
        margin:10px;
      }
      button#use-location {
        background-color: #28a745;
        margin: 0;
      }
      
      details[open] {
        background-color: #4f223c;
      }
      h1{ 
        font-family: cursive;
        margin-top: 60px;
        color:aliceblue;
      }
      body{
        text-align: center;
      }
      .main_div{

        margin:0px auto;
        margin-bottom: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 16px; 
        background-color: #7b1a1c72;
        height:200px;
        margin-left:0;
        margin-right: 0;

      }
      .details{
        width: 200px;
      }

  
      .container{
        width: 80%;
            margin:10px auto;
            display: flex;
            flex-direction:column;
            justify-content: center;
        }
        .container>.my-4{
            text-align: center;
            color: aliceblue;
            font-family:'Courier New', Courier, monospace;
            margin-top: -1;
            margin-bottom: 0;
            
        }
        

        .card{
          
          display:grid;
          max-height: 450px;
          height:auto;
          gap:10px;
          grid-template-columns: auto;
          grid-template-rows: 150px 240px 50px;
          background-color: #5f3214; 
        }
        .card.img{
          margin-bottom:10px;
          grid-row:1/2;
          overflow: hidden;
          height: 100%; 
          object-fit: cover;
        }
       
        
        .container>.my-41{
           
          color: aliceblue;
          text-align: center;
          font-family: cursive;
        }
       .card>.card-body{
        
        font-family: cursive;
          grid-row: 2/3;
          color: aliceblue;
          background-color: #5f3214;
        }
       
       .card-body>div{
        grid-row: 3/4;
       
       }
       summary{
        min-width:450;
       }

      
        </style>
    <body>
      <header class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom" id="scrollspyHeading1"> 
        
        <a href="#" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-body-emphasis text-decoration-none">
          <img class="object-fit-scale border rounded" width=10% height=auto src="../9fff2221a01549acb721c35983228c7e-free.png" style=margin:5px>
             <span class="fs-4">Foodie Frontier</span>
        </a>
         
          <ul class="nav nav-pills">
          <li class="nav-item"><a href="#scrollspyHeading1" class="nav-link" >Home</a></li>
          <li class="nav-item"><a href= "#" class="nav-link">Features</a></li>
          <li class="nav-item"><a href="#scrollspyHeading2" class="nav-link">History</a></li>
          <li class="nav-item"><a href="#scrollspyHeading3" class="nav-link">contact</a></li>
        </ul>
      </header>
         
      <h1>Search Restaurants</h1>
      
      <div class="main_div"> 
        <details class=".details">
          <summary>Search by Name</summary>
          <form id="name-search-form" action="/api/restaurants/search" method="get">
            <label for="name">Restaurant Name:</label>
            <input type="text" id="name" name="name" placeholder="Enter restaurant name">
            <button type="submit">Search</button>
          </form>
        </details>
        <details class=".details">
          <summary>Search by Location</summary>
          <form id="location-search-form" action="/api/restaurants/search" method="get">
            <label for="longitude">Longitude:</label>
            <input type="text" id="longitude" name="longitude" placeholder="Enter longitude">
            <label for="latitude">Latitude:</label>
            <input type="text" id="latitude" name="latitude" placeholder="Enter latitude">
            <div class="button">
              <button id="use-location">Use your own location</button>
              <button type="submit">Search</button>
            </div>
          </form>
        </details>
        
        <details class=".details">
          <summary>Search by Image</summary>
          <form id="image-search-form" action="/api/restaurants/search" method="get" enctype="multipart/form-data">
            <input type="file" id="image" name="image" accept="image/*">
            <button type="submit">Search</button>
          </form>
        </details>
      </div>
      
      <div class="container"> 
  
        <div id="restaurant-list" class="row"></div>
        </div>
  
 <script> document.addEventListener("DOMContentLoaded", () => {
  // Name-based search
  const nameForm = document.getElementById("name-search-form");
  if (nameForm) {
      nameForm.addEventListener("submit", async function (event) {
          event.preventDefault();
          let restaurantName = document.getElementById("name").value.trim();
          if (!restaurantName) {
              alert("Please enter a restaurant name!");
              return;
          }
          fetchRestaurants({ name: restaurantName });
      });
  }

  // Location-based search
  const locationForm = document.getElementById("location-search-form");
  if (locationForm) {
      locationForm.addEventListener("submit", function (event) {
          event.preventDefault();
          const longitude = document.getElementById("longitude").value.trim();
          const latitude = document.getElementById("latitude").value.trim();
          if (!longitude || !latitude) {
              alert("Please provide both latitude and longitude.");
              return;
          }
          fetchRestaurants({ longitude, latitude });
      });
  }

  // Use current location button
  const useLocationButton = document.getElementById("use-location");
  if (useLocationButton) {
      useLocationButton.addEventListener("click", function (event) {
          event.preventDefault();
          if (navigator.geolocation) {
              navigator.geolocation.getCurrentPosition(
                  function (position) {
                      document.getElementById("latitude").value = position.coords.latitude;
                      document.getElementById("longitude").value = position.coords.longitude;
                  },
                  function (error) {
                      console.error("Error fetching location:", error);
                      alert("Unable to retrieve your location.");
                  }
              );
          } else {
              alert("Geolocation is not supported by this browser.");
          }
      });
  }
});

// Fetch restaurants by name or location
function fetchRestaurants(params) {
  const query = new URLSearchParams(params).toString();
  const url = `http://localhost:4004/api/restaurants/search?${query}`;

  fetch(url)
      .then(response => {
          if (!response.ok) {
              return response.text().then(text => {
                  throw new Error(`Error ${response.status}: ${text}`);
              });
          }
          return response.json();
      }) 
      .then(data => displayRestaurants(data))
      .catch(error => {
          console.error("Error fetching data:", error.message);
          document.getElementById("restaurant-list").innerHTML = `<p style="color: red;">${error.message}</p>`;
      });
}

// Display restaurants in UI
function displayRestaurants(restaurants) {
  const restaurantList = document.getElementById("restaurant-list");
  restaurantList.innerHTML = '';

  if (restaurants.length === 0) {
      restaurantList.innerHTML = '<p>No restaurants found.</p>';
      return;
  }

  restaurants.forEach(restaurant => {
      const imageUrl = restaurant.Image_Url && restaurant.Image_Url.trim() !== '' 
                      ? restaurant.Image_Url 
                      : 'https://via.placeholder.com/300';
      const rating = Math.round(restaurant.Aggregate_rating);
      const stars = '★'.repeat(rating) + '☆'.repeat(5 - rating);

      const card = document.createElement('div');
      card.className = 'col-md-3';
      card.innerHTML = `
          <div class="card mb-4 shadow-sm">
              <img src="${imageUrl}" class="card-img-top" alt="${restaurant.Restaurant_name}">
              <div class="card-body">
                  <h5 class="card-title">${restaurant.Restaurant_name}</h5>
                  <p class="card-text"><strong>Average Cost for Two:</strong> ${restaurant.Average_Cost_for_two}</p>
                  <p class="card-text"><strong>Address:</strong> ${restaurant.Address}</p>
                  <p class="card-text"><strong>Rating:</strong> <span style="color:${restaurant.Rating_color};">${stars}</span> (${restaurant.Aggregate_rating})</p>
                  <a href="details.html?id=${restaurant.Restaurant_id}" class="btn btn-primary">View Details</a>
              </div>
          </div>
      `;
      restaurantList.appendChild(card);
  });
}
</script>
    </body>
  </html>